<%- include('../../views/partials/user/header',{user:user}) %>
<link rel="stylesheet" type="text/css" href="styles/categories_styles.css">
<link rel="stylesheet" type="text/css" href="styles/categories_responsive.css">
<style>
    /* Global responsive styles */
    .container {
        width: 100%;
        padding-right: 15px;
        padding-left: 15px;
        margin-right: auto;
        margin-left: auto;
    }
    
    /* Medium devices (tablets) */
    @media screen and (min-width: 768px) and (max-width: 991px) {
        .product_section_container {
            padding: 0 30px;
        }
        
        .row-cols-md-3 > * {
            flex: 0 0 50%;
            max-width: 50%;
        }
        
        .benefit_col {
            flex: 0 0 50%;
            max-width: 50%;
            margin-bottom: 20px;
        }
    }
    
    /* Small devices (mobile phones) */
    @media screen and (max-width: 767px) {
        .product_section_container {
            padding: 0 15px;
        }
        
        .product-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .product-item {
            width: 100%;
            margin-bottom: 20px;
        }
        
        .product_image img {
            width: 100%;
            height: auto;
        }
        
        .breadcrumbs {
            flex-direction: column;
            align-items: center;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .pagination {
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .pagination a {
            padding: 8px;
            font-size: 14px;
            margin: 2px;
        }
        
        .newsletter_form {
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .newsletter_submit_btn {
            margin-top: 10px;
            width: 100%;
        }
        
        .newsletter_email {
            width: 100%;
        }
        
        .benefit_item {
            flex-direction: column;
            text-align: center;
            margin-bottom: 15px;
        }
        
        .benefit_icon {
            margin-bottom: 10px;
            margin-right: 0 !important;
			
        }
		
        
        .product_sorting_container {
            flex-direction: column;
            align-items: center;
            text-align: center;
            margin-bottom: 15px;
        }
        
        .product_sorting {
            margin-bottom: 10px;
        }
        
        form.d-flex {
            flex-direction: column;
            width: 100%;
            align-items: center;
        }
        
        form.d-flex input {
            width: 100%;
            margin-bottom: 10px;
        }
        
        form.d-flex button,
        form.d-flex a {
            width: 100%;
            margin: 5px 0;
        }
        
        .row-cols-sm-2 > * {
            flex: 0 0 100%;
            max-width: 100%;
        }
        
        .benefit_col {
            flex: 0 0 100%;
            max-width: 100%;
            margin-bottom: 15px;
        }
        
        .newsletter_text {
            margin-bottom: 15px;
        }
        
        /* Improved card sizing for mobile */
        .col.mb-4 {
            padding: 0 10px;
        }
        
        .card {
            margin: 0 auto;
            max-width: 320px;
        }
    }
    
    /* Large devices (desktops) */
    @media screen and (min-width: 992px) {
        .container {
            max-width: 1140px;
        }
        
        .row-cols-lg-4 > * {
            flex: 0 0 25%;
            max-width: 25%;
        }
    }
    
    /* Extra large devices */
    @media screen and (min-width: 1200px) {
        .container {
            max-width: 1320px;
        }
    }
    
    /* Card hover effects - for better UX on all devices */
    .card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
    }
    
    /* Improved button styles for better touch targets on mobile */
    .btn {
        padding: 10px 15px;
        transition: all 0.3s ease;
    }
    
    /* Improved pagination for mobile */
    .pagination-container {
        display: flex;
        justify-content: center;
        width: 100%;
        overflow-x: auto;
        padding: 10px 0;
    }
    
    /* Responsive Sidebar */
    .sidebar {
        transition: all 0.3s ease;
    }
    
    /* Mobile sidebar toggle */
    .sidebar-toggle {
        display: none;
        background-color: #fe4c50;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 4px;
        cursor: pointer;
        margin-bottom: 15px;
        width: 100%;
        font-weight: bold;
        align-items: center;
        justify-content: center;
    }
    
    .sidebar-toggle i {
        margin-right: 8px;
    }
    
    @media screen and (max-width: 991px) {
        .sidebar-toggle {
            display: flex;
        }
        
        .sidebar {
            display: none;
            max-height: 0;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .sidebar.active {
            display: block;
            max-height: 1000px;
            transition: max-height 0.3s ease;
        }
        
        .product_section {
            flex-direction: column;
        }
        
        .main_content {
            width: 100%;
        }
    }
    
    /* Collapsible sections for mobile */
    .sidebar_title {
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
    }
    
    .sidebar_title i {
        transition: transform 0.3s ease;
    }
    
    .sidebar_title.active i {
        transform: rotate(180deg);
    }
    
    @media screen and (max-width: 767px) {
        .sidebar_categories {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .sidebar_categories.active {
            max-height: 1000px;
        }
        
        /* Improved product grid for mobile */
        .row.row-cols-1 {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .row-cols-1 > .col {
            width: 100%;
            display: flex;
            justify-content: center;
        }
    }
    
    /* Improved card layout for all screen sizes */
    .product-card-container {
        display: flex;
        justify-content: center;
        width: 100%;
    }
    
    /* Better product grid layout */
    @media screen and (max-width: 576px) {
        .row-cols-1 > .col.mb-4 {
            max-width: 100%;
            padding: 0 15px;
        }
        
        .card {
            width: 100%;
            margin: 0 auto;
        }
        
        .products_iso .container {
            padding: 0;
        }
    }
    
    /* Medium size screens */
    @media screen and (min-width: 576px) and (max-width: 767px) {
        .row-cols-sm-2 > * {
            flex: 0 0 calc(50% - 20px);
            max-width: calc(50% - 20px);
            margin: 0 10px 20px;
        }
    }
</style>
<style>
    .sidebar_section {
      margin-bottom: 20px;
    }
    .sidebar_title {
      margin-bottom: 10px;
    }
    .form-select {
      width: 100%;
      box-sizing: border-box;
    }
  </style>
<section>
    <div class="container product_section_container">
        <div class="row">
            <div class="col product_section clearfix">

                <!-- Breadcrumbs -->
                <div class="breadcrumbs d-flex flex-row align-items-center">
                    <ul>
                        <li><a href="/">Home</a></li>
                        <li class="active"><a href="/shop"><i class="fa fa-angle-right" aria-hidden="true"></i>Shop</a></li>
                    </ul>                    
                </div>
                
                <!-- Search Form -->
				<div class="mb-4">
					<form class="d-flex flex-wrap justify-content-center" method="POST" action="/search">
						<div class="w-100 mb-2 d-flex justify-content-center">
							<input class="form-control" type="search" name="search" placeholder="Search by product name"
								style="max-width: 500px; width: 100%; height:50px; border-radius: 30px;" 
								value="<%= typeof searchValue !== 'undefined' ? searchValue : '' %>" aria-label="Search">
						</div>
						<div class="d-flex">
							<button class="btn btn-outline-success me-2" type="submit">Search</button>    
							<a href="/clear" class="btn btn-outline-secondary">Clear</a>
						</div>
					</form>
				</div>
				
                
                <!-- Sidebar Toggle Button for Mobile -->
                <button class="sidebar-toggle" id="sidebarToggle">
                    <i class="fa fa-filter"></i> Show Filters
                </button>
            
                <!-- Sidebar -->
                <div class="sidebar" id="sidebar">
                   <!-- Categories Dropdown -->
<div class="sidebar_section">
    <div class="sidebar_title">
      <h5>Categories</h5>
    </div>
    <div class="dropdown w-full mb-4">
      <select class="form-select w-full p-2 border rounded" id="categoryDropdown" onchange="window.location.href=this.value">
        <option value="">Select Category</option>
        <% categories.forEach(category => { %>
          <option value="/filter?category=<%= category._id %>" 
                  <%= selectedCategory === category._id.toString() ? 'selected' : '' %>>
            <%= category.name %>
          </option>
        <% }) %>
      </select>
    </div>
  </div>
  
  <!-- Brands Dropdown -->
  <div class="sidebar_section">
    <div class="sidebar_title">
      <h5>Brands</h5>
    </div>
    <div class="dropdown w-full">
      <select class="form-select w-full p-2 border rounded" id="brandDropdown" onchange="window.location.href=this.value">
        <option value="">Select Brand</option>
        <% brands.forEach(brand => { %>
          <option value="/filter?brand=<%= brand._id %>" 
                  <%= selectedBrand === brand._id.toString() ? 'selected' : '' %>>
            <%= brand.name %>
          </option>
        <% }) %>
      </select>
    </div>
  </div>
  
 


                    <!-- Price Range Filtering -->
                    <div class="sidebar_section">
                        <div class="sidebar_title collapsible-title">
                            <h5>Filter by Price</h5>
                            <i class="fa fa-chevron-down d-md-none"></i>
                        </div>
                        <form action="" id="price-filter-form" class="collapsible-content">
                            <div class="price-option">
                                <a href="/filterPrice?gt=0&lt=500"><button class="price-btn" type="button">under ₹ 500</button></a>
                                <a href="/filterPrice?gt=1000&lt=2000"><button class="price-btn" type="button">₹ 1000 - ₹ 2000</button></a>
                                <a href="/filterPrice?gt=2000&lt=3000"><button class="price-btn" type="button">₹ 2000 - ₹ 3000</button></a>
                                <a href="/filterPrice?gt=3000&lt=4000"><button class="price-btn" type="button">₹ 3000 - ₹ 4000</button></a>
                                <a href="/filterPrice?gt=4000&lt=5000"><button class="price-btn" type="button">₹ 4000 - ₹ 5000</button></a>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Main Content -->
                <div class="main_content">
                    <!-- Products -->
                    <div class="products_iso">
                        <div class="row">
                            <div class="col">
                                <!-- Product Sorting -->
                                <div class="product_sorting_container product_sorting_container_top mb-4">
                                    <ul class="product_sorting">
                                        <li>
                                            <span class="type_sorting_text">Default Sorting</span>
                                            <i class="fa fa-angle-down"></i>
                                            <ul class="sorting_type">
                                                <li class="type_sorting_btn" data-isotope-option='{ "sortBy": "original-order" }'><span>Default Sorting</span></li>
                                                <li><a href="/sort?sort=a-z">a-z</a></li>
                                                <li><a href="/sort?sort=z-a">z-a</a></li>
                                                <li><a href="/sort?sort=low-high">Low - High</a></li>
                                                <li><a href="/sort?sort=high-low">High - Low</a></li>
                                            </ul>
                                        </li>
                                    </ul>
                                </div> 
                            
                                <!-- Product Grid -->
                                <div class="container px-0">
                                    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4 justify-content-center">
                                      
                                        <% for(let i = 0; i < products.length; i++) { %>
                                        <div class="col mb-4">
                                            <div class="product-card-container">
                                                <div class="card h-100 shadow-sm border-0">
                                                    <div class="position-relative">
                                                        <img src="uploads/re-image/<%= products[i].image[0] %>" class="card-img-top" alt="<%= products[i].name %>">
                                                        <div class="position-absolute top-0 start-0 m-2" onclick="addToWishlist('<%= products[i]._id %>')" style="cursor:pointer;">
                                                            <i class="fas fa-heart text-danger"></i>
                                                        </div>
                                              
                                                        <% if(products[i].salesPrice != products[i].basePrice) { %>
                                                        <div class="position-absolute top-0 end-0 m-2 badge bg-danger">
                                                            -<%= Math.round(((products[i].basePrice - products[i].salesPrice) / products[i].basePrice) * 100) %>%
                                                        </div>
                                                        <% } %>
                                                    </div>
                                              
                                                    <div class="card-body d-flex flex-column">
                                                        <h6 class="card-title">
                                                            <a href="/details?id=<%= products[i]._id %>" class="text-decoration-none text-dark">
                                                                <%= products[i].name %>
                                                            </a>
                                                        </h6>
                                                        <p class="card-text fw-bold mb-2 text-danger">
                                                            ₹ <%= products[i].salesPrice %>
                                                            <% if(products[i].salesPrice != products[i].basePrice) { %>
                                                                <span class="text-muted text-decoration-line-through small ms-2">₹ <%= products[i].basePrice %></span>
                                                            <% } %>
                                                        </p>
                                              
                                                        <div class="mt-auto">
                                                            <button class="btn w-100 addToCartBtn" style="background:#fe4c50;color: white;" data-id="<%= products[i]._id %>">
                                                                <i class="fas fa-shopping-cart me-2"></i>Add to cart
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <% } %>
                                    </div>
                                </div>
                                
                                <!-- Pagination -->
                                <div class="pagination-container">
                                    <div class="pagination">
                                        <% if (currentPage > 1) { %>
                                            <a href="/shop?page=<%= currentPage - 1 %>">
                                                <i class="fa-solid fa-backward"></i>
                                            </a>
                                        <% } %>
                                
                                        <% for (let i=1; i <=totalPages; i++) { %>
                                            <a href="/shop?page=<%= i %>" class="<%= currentPage === i ? 'active' : '' %>">
                                                <%= i %>
                                            </a>
                                        <% } %>
                                
                                        <% if (currentPage < totalPages) { %>
                                            <a href="/shop?page=<%= currentPage + 1 %>">
                                                <i class="fa-solid fa-forward"></i>
                                            </a>
                                        <% } %>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Benefit -->
    <div class="benefit">
        <div class="container">
            <div class="row benefit_row">
                <div class="col-lg-3 col-md-6 col-sm-6 benefit_col">
                    <div class="benefit_item d-flex flex-row align-items-center">
                        <div class="benefit_icon me-3"><i class="fa fa-truck" aria-hidden="true"></i></div>
                        <div class="benefit_content">
                            <h6>Free shipping</h6>
                            <p></p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 col-sm-6 benefit_col">
                    <div class="benefit_item d-flex flex-row align-items-center">
                        <div class="benefit_icon me-3"><i class="fa fa-money" aria-hidden="true"></i></div>
                        <div class="benefit_content">
                            <h6>cash on delivery</h6>
                            <p></p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 col-sm-6 benefit_col">
                    <div class="benefit_item d-flex flex-row align-items-center">
                        <div class="benefit_icon me-3"><i class="fa fa-undo" aria-hidden="true"></i></div>
                        <div class="benefit_content">
                            <h6>15 days return</h6>
                            <p></p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 col-sm-6 benefit_col">
                    <div class="benefit_item d-flex flex-row align-items-center">
                        <div class="benefit_icon me-3"><i class="fa fa-clock-o" aria-hidden="true"></i></div>
                        <div class="benefit_content">
                            <h6>opening all week</h6>
                            <p>8AM - 09PM</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Newsletter -->
    <div class="newsletter">
        <div class="container">
            <div class="row">
                <div class="col-lg-6">
                    <div class="newsletter_text d-flex flex-column justify-content-center align-items-lg-start align-items-center text-center">
                        <h4>Newsletter</h4>
                        <p>Subscribe to our newsletter and get 20% off your first purchase</p>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="newsletter_form d-flex flex-md-row flex-column align-items-center justify-content-lg-end justify-content-center">
                        <input id="newsletter_email" type="email" placeholder="Your email" required="required" data-error="Valid email is required." class="form-control mb-md-0 mb-3" style="max-width: 350px;">
                        <button id="newsletter_submit" type="submit" class="newsletter_submit_btn trans_300 ms-md-2" value="Submit">subscribe</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
 <style>
        .pagination {
            margin-top: 20px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }

        .pagination a {
            padding: 10px;
            margin: 4px;
            text-decoration: none;
            background-color: white;
            color: black;
            font-weight: bold;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }

        .pagination a i {
            padding: 4px;
        }

        .pagination a.active {
            background-color: #DAADCC;
            font-weight: bold;
        }
        
        @media screen and (max-width: 576px) {
            .pagination a {
                width: 35px;
                height: 35px;
                padding: 8px;
                font-size: 14px;
            }
        }
        
        .price-btn {
            padding: 5px 0px;
            border: none;
            background: transparent;
            color: rgb(81, 84, 95);
            cursor: pointer;
            margin-left: 20px;
            display: block;
            width: 100%;
            text-align: left;
            margin-bottom: 5px;
        }
        
        @media screen and (max-width: 767px) {
            .price-btn {
                padding: 8px 0;
                margin-left: 0;
                font-size: 14px;
            }
        }
        
        /* Improved card styling for all device sizes */
        .card {
            width: 100%;
            max-width: 300px;
        }
        
        /* Make sure images maintain aspect ratio */
        .card-img-top {
            width: 100%;
            height: auto;
            object-fit: cover;
            aspect-ratio: 1 / 1;
        }
        
        /* Ensure consistent card sizes across screen sizes */
        @media screen and (max-width: 576px) {
            .product-card-container {
                width: 100%;
                max-width: 320px;
                margin: 0 auto;
            }
            
            .card {
                width: 100%;
            }
        }
        
        @media screen and (min-width: 577px) and (max-width: 767px) {
            .product-card-container {
                width: 100%;
            }
        }
    </style>    
</section>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
<script>
    // Sidebar toggle functionality
    document.addEventListener('DOMContentLoaded', function() {
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebar = document.getElementById('sidebar');
        
        sidebarToggle.addEventListener('click', function() {
            sidebar.classList.toggle('active');
            
            if (sidebar.classList.contains('active')) {
                sidebarToggle.innerHTML = '<i class="fa fa-times"></i> Hide Filters';
            } else {
                sidebarToggle.innerHTML = '<i class="fa fa-filter"></i> Show Filters';
            }
        });
        
        // Mobile collapsible sections
        const collapsibleTitles = document.querySelectorAll('.collapsible-title');
        
        collapsibleTitles.forEach(title => {
            title.addEventListener('click', function() {
                if (window.innerWidth <= 767) {
                    this.classList.toggle('active');
                    const content = this.nextElementSibling;
                    content.classList.toggle('active');
                }
            });
        });
        
        // Resize handler to show sidebar on larger screens
        window.addEventListener('resize', function() {
            if (window.innerWidth > 991) {
                sidebar.classList.add('active');
            } else if (!sidebar.classList.contains('active')) {
                sidebar.classList.remove('active');
            }
        });
        
        // Initialize sidebar state based on screen size
        if (window.innerWidth > 991) {
            sidebar.classList.add('active');
        }
    });

    //Wishlist
    function addToWishlist(productId){
        $.ajax({
            url:'/wishlist',
            method:'POST',
            data:{productId:productId},
            success:(response)=>{
                if(response.status){
                    Swal.fire({
                        title: "Added to wishlist",
                        text: "The product has been added to your wishlist",
                        icon: "success",
                        timer: 2000,
                        position: 'center',
                        toast: false,
                        backdrop: true,
                        showConfirmButton: false
                    });
                } else {
                    Swal.fire({
                        title: response.message,
                        icon: "warning",
                        timer: 2000,
                        position: 'center',
                        toast: false,
                        backdrop: true,
                        showConfirmButton: false
                    });
                }
            },
            error:(error)=>{
                Swal.fire({
                    title: "Error",
                    text: "Error adding the product to your wishlist",
                    icon: "error",
                    timer: 2000,
                    position: 'center',
                    toast: false,
                    backdrop: true,
                    showConfirmButton: false
                });
            }
        });
    }

    //cart
    document.querySelectorAll(".addToCartBtn").forEach(button => {
        button.addEventListener("click", async () => {
            const productId = button.getAttribute("data-id");

            try {
                const response = await fetch(`/cart/${productId}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ quantity: 1 }) // Example quantity
                });

                const result = await response.json();

                if (result.success) {
                    Swal.fire({
                        icon: "success",
                        title: "Product added to Cart",
                        showConfirmButton: false,
                        timer:1000
                    });
                } else {
                    Swal.fire({
                        icon: "error",
                        title: "Failed to add to cart",
                        text: result.message,
                        showConfirmButton: false,
                        timer:1000
                    });
                }
            } catch (error) {
                console.error("Error:", error);
            }
        });
    });
</script>
<%- include('../../views/partials/user/footer') %>